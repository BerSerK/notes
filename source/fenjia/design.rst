++++++++++++++++++++++++++++++++++++++++
模拟程序结构设计
++++++++++++++++++++++++++++++++++++++++

这部分是设计初稿, 具体实现请查看doxygen从源码生成的文档.

Monte Carlo模拟程序设计
==============================

主控制类设计
------------------------------

数据：

1. 分级A数列, 保存一系列分级A, 以及其模拟结果数据. 具体实现是一个指针数列, 可以用上C++的多态性;
2. 系统参数:

   a. 模拟次数 :math:`C`,
   #. 指数个数 :math:`N`,
   #. 基金数 :math:`N_0`,
   #. 个股个数 :math:`m`,
   #. 因子维度 :math:`n`,
   #. 折现率,
   #. 定存利率,
   #. 标签,
   #. 日期,
   #. 最大模拟时间长度.
   

3. 配置数据:
   
   a. :math:`W\in \mathcal{R}^{N\times m}` 指数权重矩阵,
   b. :math:`X\in \mathcal{R}^{m\times n}` 暴露矩阵,
   c. :math:`\Sigma \in \mathcal{R}^{m\times m}` 对角矩阵, 模型中不可预测部分的相关矩阵,
   d. :math:`\Omega\in \mathcal{R}^{n\times n}` 因子回报 :math:`\vec{\beta}` 之间的相关矩阵,
   e. :math:`\vec{\mu}` 因子回报的预期收益, 为简单起见直接取 :math:`0`.

函数:

0. 参数设置函数, 包括从配置文件读取系统参数和配置数据;
1. 迭代模拟路径的函数, 每迭代一步我们需要: 

   a. 生成满足条件的随机向量传给各个分级A对象;
   b. 执行各个分级A的迭代步;

2. 计算总体统计量的函数(统计量都留给MATLAB算):

   a. 每个基金的平均第一次下折日;
   b. 第一向上折算日频数分布;
   c. 第一向下折算日频数分布;
   d. 折算日截尾均值;
   e. 折算日25%分位数, 50%分位数, 75%分位数, 与90%分位数;
   f. A基金优先份额久期分析;
   g. 计算隐含收益率&理论定价;

3. 以合适的格式输出函数, 输出各种数据, 以及统计信息。可以利用MATLAB, R, Python等软件二次处理这些数据, 画图展示. 

分级A虚类设计
------------------------------
考虑到不同的分级A有不同的上下折算规则, 还有不同的定期结算日期. 
需要重载这些功能, 我们设计一个虚类做一个做分级A的类模板. 

数据与参数
``````````````````````````````
模型参数(根据不同分级基金具体参数不局限于下列参数):

1. 母基金净值,
#. 基金所跟踪的指数,
#. 基金各项费用,
#. 进取份额的杠杆倍数,
#. A份的约定收益率,
#. 母基金赎回成本.

数据需要创建一个类来保存一次模拟路径中需要保留下来供后续分析的数据. 
模拟路径数据类, 包含以下数据:

1. 上折日期数列,
#. 下折日期数列,
#. 现金流数列,
#. 修正久期,
#. 理论价格,
#. 隐含收益率.

对于一个虚类中需要保存以下数据:

1. 模拟路径数据类数列, 保存多个模拟路径,
#. 模拟过程中临时保存的母基金价格, A份和B份价格.

函数与功能
``````````````````````````````

1. 固定函数, 不需重载, 重复使用:

   a. 向前迭代模拟路径: 向前迭代一步模拟路径并保存相关数据. 

2. 虚函数, 供继承类根据具体规则重载:

   a. 上下折函数
   #. 上下折条件
   #. 定期折算函数
   #. 多次下折后终止条件

其他辅助类设计
--------------------------------------------------

股票类
``````````````````````````````````````````````````
数据:

1. 编号,
2. 暴露矩阵,
3. 系统外风险.

指数类
``````````````````````````````````````````````````
数据:

1. 指数编号.
2. 指数值.
3. 指数权重.

路径类
``````````````````````````````````````````````````
数据:
1. 上折日期数列.
2. 下折日期数列.
3. 现金流数列.
