.. index:: model

模型: 分级基金A份定价问题
==============================

对分级基金A份因为其存在不定期折算, 可以通过Monte Carlo随机模拟对其理论价格进行估算. 
分级基金向下折算时, 部分A份份额将转化为母基金, 我们视这个转化为一个现金流. 
通过对下折事件的Monte Carlo模拟, 我们测算出这个现金流来估算分级A的理论价格. 

- 我们大概需要模拟100只左右的分级基金, 重点研究其中30-40只. 
- 研究过程中需要考虑分级基金之间的相关性. 
- 假设按照周频模拟15年, 100只基金, 1000条路径. 总计算规模是 :math:`10^8` . 经过我C++程序测算生成 :math:`10^8` 个满足正态分布的随机数需要30s左右的时间. 测算环境为我的笔记本CPU是1.4 GHz Intel Core i5. 可以估计出跑一遍这个模拟应该可以在几分钟内完成. 


.. index:: 模型假设

必要假设
----------------------------------------

1. 母基金按照一定持仓量严格跟踪其标的指数. 假定持仓量为95%
#. 标的指数收益服从正态分布. 
#. 假设其约定收益维持在一定水平不变. 
#. 基金各项费用保持不变. 
#. 指数之间通过QEPM模型, 以个股相关性为基础计算出其相关性.

.. index:: QEPM (Quantitative Equity Portfolio Management)

因子模型
----------------------------------------

我们通过因子模型来模拟分级A模型中需要用到的被跟踪 :math:`N` 个指数的走势路径.
设各个指数的预期收益率为 :math:`R_I\in\mathcal{R}^N` 以及指数之间的相关矩阵 :math:`\Sigma_I\in\mathcal{R}^{N\times N}` . 理论细节可以从书 `Quantitative Equity Portfolio Management (证券组合定量管理) <http://book.douban.com/subject/2799221/>`_ 中获得.  这里我给出我们用到的那一小部分. 

我们用向量 :math:`\vec{R}_I \in \mathcal{R}^N` 表示我们需要跟踪的指数. 假设总共有 :math:`m` 只个股, 目标指数以权重矩阵 :math:`W\in \mathcal{R}^{N\times m}` 组合而成. 
则 :math:`R_I=W \vec{R}` . 这里 :math:`\vec{R}\in \mathcal{R}^m` 为各个股的预期收益. 

我们假设各个股的预期收益 :math:`\vec{R}` 被 :math:`n` 个因子所决定. 

.. math::
   
   \vec{R}=X\vec{\beta} + \vec{\epsilon}

这里 :math:`\vec{\beta} \in \mathcal{R^{n}}` 表示因子回报(Factor Returns), 而 :math:`X\in \mathcal{R}^{m\times n}` 是暴露矩阵(Factor Exposure), :math:`\vec{\epsilon}` 表示一个服从正态分布的一个 :math:`m` 维随机变量, 表示市场中的不可测部分. :math:`\vec{\epsilon} \in N(0, \Sigma)` , :math:`\Sigma` 是对角矩阵. :math:`\vec{\beta} \in N(\vec{\mu}, \Omega)` . 我们还需要假设 :math:`\vec{\epsilon}` 与 :math:`\vec{\beta}` 之间相互独立. 

于是有 

.. math::
   
   \vec{R}_I = W X\vec{\beta} + W \vec{\epsilon} = W X \vec{\mu} + W X \vec{\beta_0} + W\vec{\epsilon}

这里 :math:`\vec{\beta_0}\in N(0, \Omega)`. 为了后面使用方便, 取 :math:`\vec{U}=W X\vec{\mu}`, :math:`\vec{E}=W X \vec{\beta_0} + W\vec{\epsilon}`, 于是有:

.. math::

   \vec{R}_I = \vec{U} + \vec{E}

.. math::
   
   \Sigma_I=cov(\vec{R}_I,\vec{R}_I)=W(X \Omega X^T + \Sigma )W^T

.. math::

   \vec{E}\in N(0, \Sigma_I)

于是, 我们的因子模型以 :math:`W, X, \Sigma, \Omega, \vec{\mu}` 为输入. 为了简单起见 :math:`\vec{\mu}` 可能直接取成 :math:`0`.


模拟步骤
----------------------------------------

对于每一个交易日(或者一周), 我们按照下面步骤来完成一个迭代步:

1. 根据基金条款第一次判断是否上下折算, 如果需要折算计算相关净值.
2. 基于母基金单位净值随机游走的假设, 通过下式模拟出 :math:`N` 条母基金净值未来走势路径:

.. math::
   S_t^i = S_{t-1}^{i}e^{(U(i)- \delta - \frac{1}{2} \sigma_i^2) \Delta t + \sqrt{\Delta t} \vec{E}(i)}

其中, 

- :math:`S_t^i` 为 :math:`t-1` 日的第 :math:`i` 个基金的母基金净值;
- :math:`\vec{U}(i)` 为 :math:`\vec{U}` 的第 :math:`i` 个分量;
- :math:`\delta` 为基金各项费用;
- :math:`\sigma_i` 为母基金单位净值收益率的年化波动率, :math:`\sigma_i^2=\Sigma_I(i,i)`;
- :math:`\vec{E}(i)` 为 :math:`\vec{E}` 的第 :math:`i` 个分量;
- :math:`\Delta t` 取 :math:`\frac{1}{252}` 假设一年实际交易天数为 :math:`252` 日. 

3. 对于每一条路径, 根据母基金净值计算每一个交易日的优先份额净值与进取份额净值. 

.. math::
   NAV_A=(1+R)^{t/N}

.. math::
   NAV_B=\frac{NAV_m - 0.5 NAV_A}{0.5}

其中 :math:`t = \min\{年初至T日, 自基金合同生效日至T日, 自最近一次会计年度内份额折算日至T日\}` ;

-  R为约定收益率
-  N为当年实际交易天数

..

    PS: 这里只是一个例子, 并不一定所有分级A净值都以复利计算, 有可能是单利. 分级B杠杆也不一定是两倍. 

4. 再次判断以及计算上下折算. (有的分级A是在开始前判断上下折算, 有的是在计算完净值后. )
5. 计算此步统计量. 

完成一条路径模拟之后, 需要计算一下这条路径的总体统计量. 完成所有路径模拟之后, 需要再算一次总体统计量. 


我们同时模拟多个分级基金, 分级基金之间有相关性, 生成 :math:`\epsilon` 的时候需要考虑其相关性. 


上下折算的若干问题
----------------------------------------
我们需要注意分级基金之间上下折算的触发规则一般略有不同. 除此之外, 还有下面这个问题需要在模型中考虑. 


问题不在下折, 而在溢价
````````````````````````````````````````

`原文链接 <http://mp.weixin.qq.com/s?__biz=MzA4NjE5NzgwMg==&mid=212752344&idx=1&sn=287e6810bfb32e03bed58c557a210796&scene=1&key=0acd51d81cb052bcc465767c189dacb654fdad37b20f39607bb244488f4fedef6a002eb06fea390273d58847f8aacd95&ascene=0&uin=NTU3ODAwNQ%3D%3D&devicetype=iMac+MacBookAir6%2C2+OSX+OSX+10.10.3+build(14D136)&version=11020012&pass_ticket=IwX3RnjNrmnR22N4OpExt5sUNCO9DJR8PbQ4SG%2FDukU%3D>`_

第一财经日报 郭璐庆

从场外的配资到场内的两融, 这轮暴跌行情中“去杠杆”成为新常态, 同样带有杠杆性质的分级基金成为重灾区之一. 加之日前转债进取(150189)下折创下亏损84%的历史惨案, 分级B一度成为投资者不敢逾越的禁区, 甚至达到“谈下折色变”的地步. 

“我正想说这个问题. ”华西证券金融产品研究评价中心负责人刘明军称, 下折的问题很有必要及时说清, 否则投资者的误解会越来越大. 

近期分级基金大面积下折, 出于保护A份额而制定的下折机制却在暴跌行情中导致部分投资者巨亏, 抛开目前下折尚待改进的机制不谈, 投资者教育在分级基金的缺失是非常重要的一个因素. 

15日、16日, 基金业协会官方微信连续两日推送了分级基金讲堂, 讲解分级知识. 一位基金业人士告诉《第一财经日报》记者, 现在很多分级基金面临下折, 十分有必要进行投资者教育. 

下折逻辑

分级基金的实质是B份额通过向A份额“借钱”投资于母基金, 从而获得杠杆效应. A份额的约定收益就是B份额需要支付的利息. 

通常来说, 当分级B的净值跌到0.25元(可转债是0.45元)及以下时, 就会触发向下折算, A、B份额的净值都会变为1. 这个过程是, B的净值从0.25元折算成1元, 保持净资产不变, 份额对应缩小到1/4. 而分级A与分级B份额要维持1：1, 所以1元净值的分级A也要跟着将份额缩成1/4. 分级A剩下的3/4以母基金形式返还给投资者. 

实际上, 下折是分级基金合同规定的一项保护A份额持有人利益的条款. 

“下折条款首先保护了A份额持有人的利益. 随着B份额的净值不断下降且杠杆越来越大, 如不下折, B的净值可能跌至0甚至跌穿, 无法保障A份额的本金和利息安全. ”刘明军告诉记者, 其次是下折后, B份额的杠杆也得以减小, 这将降低若后市进一步下跌给B份额持有人带来的净值加速下跌的风险. 

这就意味着, 分级基金下跌太多而不采取下折措施, 杠杆越来越高, 大盘若继续下跌, 将导致A的约定收益无法获取. 

很多案例中, 分级B持有者会出现较大损失的主要原因则是因为跌停板制度制约了分级B的价格随母基金下跌, 造成很高的扭曲溢价, 导致被动溢价越来越高甚至超过100%——而这个时候, 就非常危险了. 

“本来价格跟着净值走, 合理情况下应该保持稳定的折价或溢价, 而接近下折时溢价越来越高. 大跌时净值跌得很快可能导致价格跟不上净值下跌的速度, 接近下折(原文此处为下跌应为手误)时杠杆约有5倍, 意味着标的指数跌2%以上它就跌10%以上. 但是由于有跌停板限制跌不了10%以上, 导致被动溢价越来越高, 最终导致溢价超过100%. ”刘明军解释道. 

进一步举例假设, 某一分级B的净值是10万, 溢价100%后市价变为20万, 当下折后净值变为1, 但资产还是10万, 而这个时候由于失去了5倍的杠杆, 最多只有20%的溢价, 即市价变成了12万. 所以下折后, 投资者的亏损将达到40%. 

问题不在“折”而在溢价

“其实问题的核心不在于是否下折, 而是是否有高溢价. ”深圳一位公募基金公司人士表示. 

这也得到了刘明军的认同. “如果下折前溢价没那么高, 下折条款触发后, 并不会产生市值的缩水, 下折前后并不会有大幅的亏损. ”他说. 

所以在刘明军看来, 如果不是市场连续暴跌, B份额是不可能产生超过100%的溢价, 也就不可能造成巨额的亏损. 

在转债进取下折的案例中, 截至2015年7月7日, 转债进取份额收盘价为0.638元, 溢价率高达101.26%, 这也就最后导致了超过80%的亏损. 同样, 在不定期份额折算后其杠杆倍数将大幅降低, 恢复到初始杠杆水平, 其溢价率便大幅降低. 

“下折或者不下折, 一定要关心的指标是整体溢价包括B的溢价. 整体溢价是最核心的, 高了就小心, B的溢价高了也会产生问题. ”上述深圳公募基金公司人士说. 

“之所以这次下折造成B类持有人巨亏, 关键是因为这次股市连续暴跌造成流动性问题, 基金净值损失过快, 跌停板制度, 两者结合起来造成基金的大幅溢价, 折算后由于杠杆的大幅降低, 溢价也大幅降低, 从而造成折算前后B类投资者市值大幅缩水. ”刘明军表示. 

简单来说, 在下折附近投资分级B要“三规避”：一是规避整体溢价率过高的分级B;二是规避分级A折价率高、分级B溢价率过高的分级B;第三个则是规避母基金短期存在下行风险的分级B. 

最新数据提示, 现在需要注意下折风险的分级B有六只, 分别是一带B、同瑞B、转债B级、工业4B、电子B和国企改B, 溢价率依次是4.31%、22.75%、40.13%、44.38%、13.31%和45.62%. 

母基金整体溢价率最高的则是工业4和国企改革, 母基金溢价率达到了4.49%和4.32%. 

另外, 对于高溢价的转债B级、工业4B和国企改B, 触发下折需要母基金跌幅分别是6.76%、7.46%和9.19%. 

“分级基金只是工具, 本身没有好坏, 关键是要搞懂, 不懂不要乱买, 已经下折还去买就太不划算了. 客观地说, 如果行情不好, 最好的办法就是不要做B, 这不是下折不下折的问题. ”深圳一位公募基金公司人士直言道. 





